#!/usr/bin/env bash

#export templdpath=$LD_LIBRARY_PATH
#export LD_LIBRARY_PATH=./linux64:$LD_LIBRARY_PATH
#export SteamAppId=892970


#echo "Starting server PRESS CTRL-C to exit"

# Tip: Make a local copy of this script to avoid it being overwritten by steam.
# NOTE: Minimum password length is 5 characters & Password cant be in the server name.
# NOTE: You need to make sure the ports 2456-2458 is being forwarded to your server through your local router & firewall.

steamcmd +login anonymous +force_install_dir {{ install_dir }} +app_update {{ steam_game_id }} +quit

{% for server in servers %}
./valheim_server.x86_64 -name "{{ server.name }}" -port {{ server.port }} -world "Dedicated" -password "{{ server.password }}" >/dev/null &
{% endfor %}

while :
do
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
echo "valheim.service: timestamp ${TIMESTAMP}"
sleep 60
done
